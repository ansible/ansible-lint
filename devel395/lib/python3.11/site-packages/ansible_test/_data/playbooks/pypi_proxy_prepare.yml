- name: Prepare PyPI proxy configuration
  hosts: all
  gather_facts: no
  tasks:
    - name: Make sure the ~/.pip directory exists
      file:
        path: ~/.pip
        state: directory
    - name: Configure a custom index for pip based installs
      copy:
        content: |
          [global]
          index-url = {{ pypi_endpoint }}
          trusted-host = {{ pypi_hostname }}
        dest: ~/.pip/pip.conf
        force: "{{ force }}"
    - name: Configure a custom index for easy_install based installs
      copy:
        content: |
          [easy_install]
          index_url = {0}
        dest: ~/.pydistutils.cfg
        force: "{{ force }}"
